name: CI

on: 
  push: 
    branches: [ canary, dev-v2 ]
    paths-ignore: 
      - '**.md'
      - '**.txt'
      - '.github/**'
      - '!.github/workflows/**'
  pull_request: 
    branches: [ dev-v2, v2 ]

jobs:
  build: 
    name: Build Production Pages
    runs-on: ubuntu-latest
    steps: 
     - name: 🧐 Checkout
       id: checkout
       uses: actions/checkout@v3

     - name: 🔧 Setup pnpm
       id: setup_pnpm
       uses: pnpm/action-setup@v2
       with: 
         version: latest

     - name: 🚧 Setup dependencies
       id: setup_deps
       run: |
         sudo apt-get install zip
         pnpm install @vue/cli -g
         pnpm install

     - name: 📦 Build production pages
       id: build
       run: |
         pnpm build
         zip -r dist.${{ github.event.head_commit.id }}.zip dist

  upload: 
    needs: build
    name: Upload to Artifact
    runs-on: ubuntu-latest
    steps: 
     - name: 🌐 Upload builds
       id: upload
       uses: actions/upload-artifact@v3
       with: 
         name: dist.${{ github.event.head_commit.id }}
         path: dist.${{ github.event.head_commit.id }}.zip
         retention-days: 7
